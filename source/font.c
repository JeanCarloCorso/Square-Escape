#include "font.h"
#include "graphics.h" // precisa conter setPixel

// Fonte 5x5 pixels: cada byte representa uma coluna de 5 bits
static const u8 font5x5[36][5] = {
    // Letras A-Z
    {0x1F,0x05,0x05,0x1F,0x00}, // A
    {0x1F,0x15,0x15,0x0A,0x00}, // B
    {0x0E,0x11,0x11,0x11,0x00}, // C
    {0x1F,0x11,0x11,0x0E,0x00}, // D
    {0x1F,0x15,0x15,0x11,0x00}, // E
    {0x1F,0x05,0x05,0x01,0x00}, // F
    {0x0E,0x11,0x15,0x1D,0x00}, // G
    {0x1F,0x04,0x04,0x1F,0x00}, // H
    {0x11,0x1F,0x11,0x00,0x00}, // I
    {0x08,0x10,0x10,0x0F,0x00}, // J
    {0x1F,0x04,0x0A,0x11,0x00}, // K
    {0x1F,0x10,0x10,0x10,0x00}, // L
    {0x1F,0x02,0x04,0x02,0x1F}, // M
    {0x1F,0x02,0x04,0x1F,0x00}, // N
    {0x0E,0x11,0x11,0x0E,0x00}, // O
    {0x1F,0x05,0x05,0x02,0x00}, // P
    {0x0E,0x11,0x19,0x1E,0x00}, // Q
    {0x1F,0x05,0x0D,0x12,0x00}, // R
    {0x12,0x15,0x15,0x09,0x00}, // S
    {0x01,0x1F,0x01,0x00,0x00}, // T
    {0x0F,0x10,0x10,0x0F,0x00}, // U
    {0x07,0x08,0x10,0x08,0x07}, // V
    {0x1F,0x08,0x04,0x08,0x1F}, // W
    {0x11,0x0A,0x04,0x0A,0x11}, // X
    {0x01,0x02,0x1C,0x02,0x01}, // Y
    {0x19,0x15,0x13,0x00,0x00}, // Z

    // Números 0-9
    {0x0E,0x11,0x11,0x0E,0x00}, // 0
    {0x12,0x1F,0x10,0x00,0x00}, // 1
    {0x19,0x15,0x15,0x12,0x00}, // 2
    {0x11,0x15,0x15,0x0A,0x00}, // 3
    {0x07,0x04,0x1F,0x04,0x00}, // 4
    {0x17,0x15,0x15,0x09,0x00}, // 5
    {0x0E,0x15,0x15,0x08,0x00}, // 6
    {0x01,0x01,0x1D,0x03,0x00}, // 7
    {0x0A,0x15,0x15,0x0A,0x00}, // 8
    {0x02,0x15,0x15,0x0E,0x00}  // 9
};

// Mapeamento caracteres: A-Z -> 0-25, 0-9 -> 26-35
static int charToIndex(char c) {
    if(c >= 'A' && c <= 'Z') return c - 'A';
    if(c >= '0' && c <= '9') return 26 + (c - '0');
    return -1; // caractere inválido
}

void drawChar(int x, int y, char c, u16 cor){
    int idx = charToIndex(c);
    if(idx < 0) return;

    for(int col = 0; col < 5; col++){
        u8 bits = font5x5[idx][col];
        for(int row = 0; row < 5; row++){
            if(bits & (1 << row)){
                int px = x + col;
                int py = y + row;
                if(px >= 0 && px < SCREEN_WIDTH && py >= 0 && py < SCREEN_HEIGHT){
                    setPixel(px, py, cor);
                }
            }
        }
    }
}

void drawString(int x, int y, const char* str, u16 cor){
    int offsetX = 0;
    for(int i = 0; str[i]; i++){
        drawChar(x + offsetX, y, str[i], cor);
        offsetX += 6; // 5 pixels + 1 espaço
    }
}

void drawStringClear(int x, int y, const char* str, u16 cor, u16 bg){
    int offsetX = 0;
    for(int i = 0; str[i]; i++){
        // Limpa área do caractere
        for(int dy = 0; dy < 5; dy++){
            for(int dx = 0; dx < 5; dx++){
                int px = x + offsetX + dx;
                int py = y + dy;
                if(px >= 0 && px < SCREEN_WIDTH && py >= 0 && py < SCREEN_HEIGHT){
                    setPixel(px, py, bg);
                }
            }
        }
        drawChar(x + offsetX, y, str[i], cor);
        offsetX += 6;
    }
}
